import React, { useState } from 'react';import React, { useState, useEffect } from 'react';

import { useDispatch, useSelector } from 'react-redux';import { useDispatch, useSelector } from 'react-redux';

import { useNavigate, Link } from 'react-router-dom';import { useNavigate, Link } from 'react-router-dom';

import { loginUser, selectIsLoading, selectAuthError } from '../store/slices/authSlice';import { login, clearError } from '../redux/authSlice';

import { toast } from 'react-toastify';

import './Login.css';const Login = () => {

  const [email, setEmail] = useState('');

const Login = () => {  const [password, setPassword] = useState('');

  const dispatch = useDispatch();  const dispatch = useDispatch();

  const navigate = useNavigate();  const navigate = useNavigate();

  const isLoading = useSelector(selectIsLoading);  const { isAuthenticated, loading, error } = useSelector((state) => state.auth);

  const error = useSelector(selectAuthError);

    useEffect(() => {

  const [formData, setFormData] = useState({    if (isAuthenticated) {

    email: '',      navigate('/profile');

    password: ''    }

  });  }, [isAuthenticated, navigate]);



  const handleChange = (e) => {  useEffect(() => {

    const { name, value } = e.target;    return () => dispatch(clearError());

    setFormData(prev => ({ ...prev, [name]: value }));  }, [dispatch]);

  };

  const handleSubmit = async (e) => {

  const handleSubmit = async (e) => {    e.preventDefault();

    e.preventDefault();    await dispatch(login({ email, password }));

      };

    console.log('ğŸ” Attempting login...', { email: formData.email });

      return (

    try {    <div className="auth-container">

      const result = await dispatch(loginUser(formData)).unwrap();      <div className="auth-box">

              <h2>ğŸ” ÄÄƒng Nháº­p</h2>

      console.log('âœ… Login successful:', result);        

      toast.success(`ChÃ o má»«ng ${result.user.name}! ğŸ‰`);        {error && <div className="alert alert-error">{error}</div>}

              

      // Redirect based on role        <form onSubmit={handleSubmit}>

      if (result.user.role === 'admin') {          <div className="form-group">

        navigate('/admin');            <label>Email</label>

      } else {            <input

        navigate('/profile');              type="email"

      }              value={email}

    } catch (err) {              onChange={(e) => setEmail(e.target.value)}

      console.error('âŒ Login failed:', err);              placeholder="admin@example.com"

      toast.error(err || 'ÄÄƒng nháº­p tháº¥t báº¡i');              required

    }            />

  };          </div>



  return (          <div className="form-group">

    <div className="login-page">            <label>Máº­t kháº©u</label>

      <div className="login-container">            <input

        <div className="login-card">              type="password"

          <h1>ğŸ” ÄÄƒng nháº­p</h1>              value={password}

          <p className="subtitle">ChÃ o má»«ng trá»Ÿ láº¡i!</p>              onChange={(e) => setPassword(e.target.value)}

              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢"

          {error && (              required

            <div className="error-banner">            />

              âŒ {error}          </div>

            </div>

          )}          <button type="submit" className="btn btn-primary" disabled={loading}>

            {loading ? 'Äang Ä‘Äƒng nháº­p...' : 'ÄÄƒng Nháº­p'}

          <form onSubmit={handleSubmit}>          </button>

            <div className="form-group">        </form>

              <label htmlFor="email">ğŸ“§ Email</label>

              <input        <div className="auth-links">

                type="email"          <Link to="/forgot-password">QuÃªn máº­t kháº©u?</Link>

                id="email"          {' | '}

                name="email"          <Link to="/signup">ÄÄƒng kÃ½ tÃ i khoáº£n má»›i</Link>

                placeholder="your@email.com"        </div>

                value={formData.email}

                onChange={handleChange}        <div style={{ marginTop: '30px', padding: '15px', background: '#f9f9f9', borderRadius: '8px', fontSize: '14px' }}>

                required          <strong>ğŸ§ª Test Accounts:</strong><br />

                disabled={isLoading}          Admin: admin@example.com / admin123<br />

              />          User: john@example.com / john123

            </div>        </div>

      </div>

            <div className="form-group">    </div>

              <label htmlFor="password">ğŸ”’ Máº­t kháº©u</label>  );

              <input};

                type="password"

                id="password"export default Login;

                name="password"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                value={formData.password}
                onChange={handleChange}
                required
                disabled={isLoading}
              />
            </div>

            <button 
              type="submit" 
              className="btn-primary"
              disabled={isLoading}
            >
              {isLoading ? 'â³ Äang Ä‘Äƒng nháº­p...' : 'âœ… ÄÄƒng nháº­p'}
            </button>
          </form>

          <div className="links">
            <Link to="/forgot-password">ğŸ”‘ QuÃªn máº­t kháº©u?</Link>
            <span className="divider">|</span>
            <Link to="/signup">âœï¸ ÄÄƒng kÃ½ tÃ i khoáº£n má»›i</Link>
          </div>

          <div className="demo-accounts">
            <p><strong>ğŸ­ Demo Accounts:</strong></p>
            <ul>
              <li>ğŸ‘‘ Admin: admin@example.com / admin123</li>
              <li>ğŸ‘¤ User: user@example.com / user123</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Login;
